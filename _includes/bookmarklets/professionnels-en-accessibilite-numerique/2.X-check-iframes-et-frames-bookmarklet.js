javascript:(function checkIframesAndFrames() { function getAllShadowRoots(root = document) { const shadowRoots = []; const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT); let node; while ((node = walker.nextNode())) { if (node.shadowRoot) { shadowRoots.push(node.shadowRoot); shadowRoots.push(...getAllShadowRoots(node.shadowRoot)); } } return shadowRoots; } function querySelectorAllInRoot(selector, root) { return Array.from(root.querySelectorAll(selector)); } const allRoots = [document, ...getAllShadowRoots()]; const shadowRootCount = allRoots.length - 1; const allIframesAndFrames = []; allRoots.forEach((root) => { const frames = querySelectorAllInRoot('iframe, frame', root); allIframesAndFrames.push(...frames); }); if (allIframesAndFrames.length === 0) { alert('2.1 NA et 2.2 NA : pas de cadres sur la page.'); return true; } const iframesAndFramesWithoutTitle = allIframesAndFrames.filter( (iframeOrFrame) => !iframeOrFrame.hasAttribute('title') ); const iframesAndFramesWithTitle = allIframesAndFrames.filter( (iframeOrFrame) => iframeOrFrame.hasAttribute('title') ); const framesInDocument = querySelectorAllInRoot('iframe, frame', document); const framesInShadow = allIframesAndFrames.filter( (frame) => !framesInDocument.includes(frame) ); const framesWithoutTitleInDocument = framesInDocument.filter( (f) => !f.hasAttribute('title') ); const framesWithoutTitleInShadow = framesInShadow.filter( (f) => !f.hasAttribute('title') ); const framesWithTitleInDocument = framesInDocument.filter((f) => f.hasAttribute('title') ); const framesWithTitleInShadow = framesInShadow.filter((f) => f.hasAttribute('title') ); let message = ''; let messageIframesAndFramesWithoutTitle = ''; let messageIframesAndFramesWithTitle = ''; console.clear(); if (iframesAndFramesWithoutTitle.length === 0) { messageIframesAndFramesWithoutTitle += '2.1 C : tous les cadres ont un attribut title'; } else { const locationParts = []; if (framesWithoutTitleInDocument.length > 0) { locationParts.push( `${framesWithoutTitleInDocument.length} dans le document` ); } if (framesWithoutTitleInShadow.length > 0) { locationParts.push( `${framesWithoutTitleInShadow.length} dans shadow DOM` ); } const location = locationParts.length > 0 ? ` (${locationParts.join(', ')})` : ''; messageIframesAndFramesWithoutTitle += '2.1 NC : ' + iframesAndFramesWithoutTitle.length + " cadres n'ont pas d'attribut title" + location; if (iframesAndFramesWithoutTitle.length === 1) { messageIframesAndFramesWithoutTitle = messageIframesAndFramesWithoutTitle.replace( "cadres n'ont pas", "cadre n'a pas" ); } console.log(messageIframesAndFramesWithoutTitle + ' :'); iframesAndFramesWithoutTitle.forEach((iframeOrFrame) => console.log(iframeOrFrame) ); } message += messageIframesAndFramesWithoutTitle; if (iframesAndFramesWithTitle.length === 0) { messageIframesAndFramesWithTitle += "2.2 NA : tous les cadres n'ont pas d'attribut title"; } else { const locationParts = []; if (framesWithTitleInDocument.length > 0) { locationParts.push( `${framesWithTitleInDocument.length} dans le document` ); } if (framesWithTitleInShadow.length > 0) { locationParts.push(`${framesWithTitleInShadow.length} dans shadow DOM`); } const location = locationParts.length > 0 ? ` (${locationParts.join(', ')})` : ''; messageIframesAndFramesWithTitle += '2.2 : ' + iframesAndFramesWithTitle.length + ' cadres ont un attribut title' + location; if (iframesAndFramesWithTitle.length === 1) { messageIframesAndFramesWithTitle = messageIframesAndFramesWithTitle.replace('cadres ont', 'cadre a'); } console.log(messageIframesAndFramesWithTitle + ' :'); iframesAndFramesWithTitle.forEach((iframeOrFrame) => console.log(iframeOrFrame) ); } message += '.\n'; message += messageIframesAndFramesWithTitle; if (shadowRootCount > 0) { message += `\n${shadowRootCount} shadow root(s) analysé(s).`; } message += '\nVoir la console pour plus de détails.'; allRoots.forEach((root, index) => { const rootName = index === 0 ? 'Document principal' : `Shadow root ${index}`; const frames = querySelectorAllInRoot('iframe, frame', root); if (frames.length > 0) { console.log(`\n${rootName}:`); frames.forEach((frame) => console.log(frame)); } }); alert(message); })();